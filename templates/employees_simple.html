<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Empleados</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #3b82f6;
            --success-green: #10b981;
            --warning-orange: #f97316;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
            color: var(--text-primary);
            padding: 1rem;
        }

        .search-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .search-bar {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .employees-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .employee-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 1.5rem;
            position: relative;
        }

        .employee-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .employee-avatar {
            width: 48px;
            height: 48px;
            background: var(--primary-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .employee-info h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .employee-id {
            font-size: 0.85rem;
            color: var(--text-tertiary);
        }

        .employee-details {
            margin-bottom: 1rem;
        }

        .detail-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .detail-icon {
            width: 16px;
            color: var(--text-tertiary);
        }

        .employee-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.5rem 0.75rem;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .btn-primary { background: var(--primary-blue); color: white; }
        .btn-success { background: var(--success-green); color: white; }
        .btn-warning { background: var(--warning-orange); color: white; }
        .btn-danger { background: #ef4444; color: white; }

        .status-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-active {
            background: #dcfce7;
            color: #166534;
        }

        .badge-inactive {
            background: #fef2f2;
            color: #991b1b;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-tertiary);
        }

        /* ALERTAS PERSONALIZADAS */
        .custom-alert {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease-out;
        }

        .alert-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.3s ease-out;
            text-align: center;
        }

        .alert-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: white;
        }

        .alert-icon.success { background: var(--success-green); }
        .alert-icon.error { background: #ef4444; }
        .alert-icon.warning { background: var(--warning-orange); }
        .alert-icon.info { background: var(--primary-blue); }
        .alert-icon.question { background: #8b5cf6; }

        .alert-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .alert-message {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .alert-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }

        .alert-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .alert-btn.primary { background: var(--primary-blue); color: white; }
        .alert-btn.success { background: var(--success-green); color: white; }
        .alert-btn.danger { background: #ef4444; color: white; }
        .alert-btn.secondary { background: #f1f5f9; color: var(--text-secondary); border: 1px solid #e2e8f0; }

        .alert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ANIMACIONES DE CARGA */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 4000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(3px);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            margin-top: 1rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* TRANSICIONES SUAVES */
        .tab-content {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .tab-content.active {
            opacity: 1;
            transform: translateY(0);
        }

        .employee-card {
            transition: all 0.3s ease;
        }

        .employee-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .btn {
            transition: all 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }
        @media (max-width: 768px) {
            .search-bar { flex-direction: column; }
            .employees-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- BARRA DE BÚSQUEDA -->
    <div class="search-section">
        <div class="search-bar">
            <div style="position: relative; flex: 1;">
                <i class="fas fa-search" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-tertiary);"></i>
                <input type="text" class="search-input" placeholder="Buscar empleados..." id="searchInput" onkeyup="filterEmployees()">
            </div>
            <button class="btn btn-success" onclick="addEmployee()">
                <i class="fas fa-user-plus"></i>
                Agregar
            </button>
            <button class="btn btn-primary" onclick="loadEmployees()">
                <i class="fas fa-sync-alt"></i>
                Actualizar
            </button>
        </div>
    </div>

    <!-- GRID DE EMPLEADOS -->
    <div class="employees-grid" id="employeesGrid">
        <div class="empty-state">
            <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
            <h3>Cargando empleados...</h3>
        </div>
    </div>

    <script>
        // Funciones de loading
        function showLoading(message = 'Cargando...') {
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';
            overlay.id = 'loadingOverlay';
            overlay.innerHTML = `
                <div style="text-align: center;">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">${message}</div>
                </div>
            `;
            document.body.appendChild(overlay);
        }
        
        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.remove();
            }
        }
        function showCustomAlert(title, message, type = 'info', buttons = null) {
            return new Promise((resolve) => {
                document.querySelectorAll('.custom-alert').forEach(alert => alert.remove());
                
                const alertDiv = document.createElement('div');
                alertDiv.className = 'custom-alert';
                
                const iconMap = {
                    success: 'fa-check',
                    error: 'fa-times',
                    warning: 'fa-exclamation-triangle',
                    info: 'fa-info-circle',
                    question: 'fa-question'
                };
                
                const defaultButtons = buttons || [{
                    text: 'Aceptar',
                    class: 'primary',
                    value: true
                }];
                
                alertDiv.innerHTML = `
                    <div class="alert-content">
                        <div class="alert-icon ${type}">
                            <i class="fas ${iconMap[type] || 'fa-info-circle'}"></i>
                        </div>
                        <div class="alert-title">${title}</div>
                        <div class="alert-message">${message}</div>
                        <div class="alert-actions">
                            ${defaultButtons.map((btn, index) => `
                                <button class="alert-btn ${btn.class}" data-value="${btn.value}" data-index="${index}">
                                    ${btn.icon ? `<i class="fas ${btn.icon}"></i> ` : ''}${btn.text}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                document.body.appendChild(alertDiv);
                
                alertDiv.querySelectorAll('.alert-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const value = btn.dataset.value === 'true' ? true : btn.dataset.value === 'false' ? false : btn.dataset.value;
                        alertDiv.remove();
                        resolve(value);
                    });
                });
                
                const escHandler = (e) => {
                    if (e.key === 'Escape') {
                        alertDiv.remove();
                        document.removeEventListener('keydown', escHandler);
                        resolve(false);
                    }
                };
                document.addEventListener('keydown', escHandler);
            });
        }
        
        function showSuccess(title, message) {
            return showCustomAlert(title, message, 'success');
        }
        
        function showError(title, message) {
            return showCustomAlert(title, message, 'error');
        }
        
        function showConfirm(title, message) {
            return showCustomAlert(title, message, 'question', [
                {
                    text: 'Cancelar',
                    class: 'secondary',
                    value: false,
                    icon: 'fa-times'
                },
                {
                    text: 'Confirmar',
                    class: 'danger',
                    value: true,
                    icon: 'fa-check'
                }
            ]);
        }
        let allEmployees = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadEmployees();
        });

        function loadEmployees() {
            showLoading('Cargando empleados...');
            
            fetch('/api/employees')
                .then(response => response.json())
                .then(data => {
                    allEmployees = data;
                    setTimeout(() => {
                        displayEmployees(data);
                        hideLoading();
                    }, 300); // Reducido de 500ms
                })
                .catch(error => {
                    console.error('Error:', error);
                    hideLoading();
                    showEmptyState('Error al cargar empleados');
                });
        }

        function displayEmployees(employees) {
            const grid = document.getElementById('employeesGrid');
            
            if (employees.length === 0) {
                showEmptyState('No hay empleados registrados');
                return;
            }

            grid.innerHTML = employees.map(emp => `
                <div class="employee-card">
                    <div class="status-badge ${emp.active ? 'badge-active' : 'badge-inactive'}">
                        ${emp.active ? 'Activo' : 'Inactivo'}
                    </div>
                    
                    <div class="employee-header">
                        <div class="employee-avatar">
                            ${emp.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="employee-info">
                            <h3>${emp.name}</h3>
                            <div class="employee-id">ID: ${emp.employee_id}</div>
                        </div>
                    </div>

                    <div class="employee-details">
                        <div class="detail-row">
                            <i class="fas fa-building detail-icon"></i>
                            <span>${emp.department}</span>
                        </div>
                        <div class="detail-row">
                            <i class="fas fa-clock detail-icon"></i>
                            <span>${emp.schedule}</span>
                        </div>
                        ${emp.phone ? `
                        <div class="detail-row">
                            <i class="fas fa-phone detail-icon"></i>
                            <span>${emp.phone}</span>
                        </div>
                        ` : ''}
                        ${emp.email ? `
                        <div class="detail-row">
                            <i class="fas fa-envelope detail-icon"></i>
                            <span>${emp.email}</span>
                        </div>
                        ` : ''}
                    </div>

                    <div class="employee-actions">
                        <button class="btn btn-primary" onclick="editEmployee('${emp.employee_id}')" title="Editar empleado">
                            <i class="fas fa-edit"></i>
                            Editar
                        </button>
                        <button class="btn ${emp.active ? 'btn-warning' : 'btn-success'}" 
                                onclick="toggleEmployee('${emp.employee_id}', ${emp.active})" 
                                title="${emp.active ? 'Desactivar' : 'Activar'} empleado">
                            <i class="fas fa-${emp.active ? 'pause' : 'play'}"></i>
                            ${emp.active ? 'Desactivar' : 'Activar'}
                        </button>
                        <button class="btn btn-danger" onclick="deleteEmployee('${emp.employee_id}', '${emp.name}')" title="Eliminar empleado">
                            <i class="fas fa-trash"></i>
                            Eliminar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function showEmptyState(message) {
            const grid = document.getElementById('employeesGrid');
            grid.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                    <h3>${message}</h3>
                </div>
            `;
        }

        function filterEmployees() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allEmployees.filter(emp => 
                emp.name.toLowerCase().includes(searchTerm) ||
                emp.employee_id.toLowerCase().includes(searchTerm) ||
                emp.department.toLowerCase().includes(searchTerm)
            );
            displayEmployees(filtered);
        }

        function addEmployee() {
            // Crear modal dinámico
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex;
                align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white; border-radius: 12px; padding: 2rem;
                    max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;
                    box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-user-plus" style="color: var(--primary-blue);"></i>
                            Nuevo Empleado
                        </h3>
                        <button onclick="this.closest('div').parentElement.remove()" style="
                            background: none; border: none; font-size: 1.2rem; cursor: pointer;
                            color: var(--text-tertiary); padding: 0.5rem;
                        ">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form id="newEmployeeForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-id-badge" style="margin-right: 0.5rem; color: var(--primary-blue);"></i>
                                    ID del Empleado *
                                </label>
                                <input type="text" id="newEmpId" required style="
                                    width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
                                    border-radius: 6px; font-size: 1rem;
                                " placeholder="EMP001">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-user" style="margin-right: 0.5rem; color: var(--success-green);"></i>
                                    Nombre Completo *
                                </label>
                                <input type="text" id="newEmpName" required style="
                                    width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
                                    border-radius: 6px; font-size: 1rem;
                                " placeholder="Nombre y apellidos">
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-building" style="margin-right: 0.5rem; color: var(--warning-orange);"></i>
                                    Departamento
                                </label>
                                <select id="newEmpDept" style="
                                    width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
                                    border-radius: 6px; font-size: 1rem;
                                ">
                                    <option value="General">General</option>
                                    <option value="Reacondicionamiento">Reacondicionamiento</option>
                                    <option value="Ventas">Ventas</option>
                                    <option value="Administración">Administración</option>
                                    <option value="Logística">Logística</option>
                                    <option value="Calidad">Control de Calidad</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-clock" style="margin-right: 0.5rem; color: var(--primary-blue);"></i>
                                    Horario
                                </label>
                                <select id="newEmpSchedule" style="
                                    width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
                                    border-radius: 6px; font-size: 1rem;
                                ">
                                    <option value="reacondicionamiento">Reacondicionamiento (L-J: 7:00-17:00, V: 7:00-16:00)</option>
                                    <option value="turnos">Turnos (Asignar después)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-phone" style="margin-right: 0.5rem; color: var(--success-green);"></i>
                                    Teléfono
                                </label>
                                <input type="tel" id="newEmpPhone" style="
                                    width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
                                    border-radius: 6px; font-size: 1rem;
                                " placeholder="+57 300 123 4567">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-envelope" style="margin-right: 0.5rem; color: var(--primary-blue);"></i>
                                    Email
                                </label>
                                <input type="email" id="newEmpEmail" style="
                                    width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
                                    border-radius: 6px; font-size: 1rem;
                                " placeholder="empleado@pcshek.com">
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: flex-end; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                            <button type="button" onclick="this.closest('div').parentElement.remove()" style="
                                padding: 0.75rem 1.5rem; border: 1px solid #e5e7eb; background: #f8fafc;
                                border-radius: 6px; cursor: pointer; color: var(--text-secondary);
                            ">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="submit" style="
                                padding: 0.75rem 1.5rem; border: none; background: var(--success-green);
                                color: white; border-radius: 6px; cursor: pointer; font-weight: 600;
                            ">
                                <i class="fas fa-check"></i> Agregar Empleado
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Manejar envío del formulario
            document.getElementById('newEmployeeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const employeeData = {
                    employee_id: document.getElementById('newEmpId').value.trim(),
                    name: document.getElementById('newEmpName').value.trim(),
                    department: document.getElementById('newEmpDept').value,
                    schedule: document.getElementById('newEmpSchedule').value,
                    phone: document.getElementById('newEmpPhone').value.trim(),
                    email: document.getElementById('newEmpEmail').value.trim()
                };
                
                if (!employeeData.employee_id || !employeeData.name) {
                    showError('Campos Requeridos', 'Por favor completa los campos obligatorios (ID y Nombre)');
                    return;
                }
                
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Agregando...';
                
                fetch('/api/employees', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(employeeData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showSuccess('Empleado Agregado', 'El empleado ha sido agregado exitosamente');
                        modal.remove();
                        loadEmployees();
                    } else {
                        showError('Error', data.message);
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = '<i class="fas fa-check"></i> Agregar Empleado';
                    }
                })
                .catch(error => {
                    showError('Error de Conexión', 'No se pudo agregar el empleado. Verifica tu conexión.');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> Agregar Empleado';
                });
            });
            
            // Cerrar modal al hacer clic fuera
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function editEmployee(employeeId) {
            const employee = allEmployees.find(emp => emp.employee_id === employeeId);
            if (!employee) return;

            // Crear modal de edición
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.6); z-index: 2000; display: flex;
                align-items: center; justify-content: center; backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white; border-radius: 16px; padding: 2rem;
                    max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;
                    box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb;">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: 0.75rem;">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--warning-orange), var(--success-green)); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-edit" style="color: white;"></i>
                            </div>
                            Editar Empleado
                        </h3>
                        <button onclick="this.closest('div').parentElement.remove()" style="
                            background: none; border: none; font-size: 1.5rem; cursor: pointer;
                            color: var(--text-tertiary); padding: 0.5rem;
                        ">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form id="editEmployeeForm">
                        <input type="hidden" id="editEmpId" value="${employee.employee_id}">
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-id-badge" style="margin-right: 0.5rem; color: var(--primary-blue);"></i>
                                    ID del Empleado
                                </label>
                                <div style="padding: 0.75rem; background: #f8fafc; border: 2px solid #e5e7eb; border-radius: 6px; color: var(--text-secondary);">
                                    ${employee.employee_id}
                                </div>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-user" style="margin-right: 0.5rem; color: var(--success-green);"></i>
                                    Nombre Completo *
                                </label>
                                <input type="text" id="editEmpName" required value="${employee.name}" style="
                                    width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
                                    border-radius: 6px; font-size: 1rem;
                                ">
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-building" style="margin-right: 0.5rem; color: var(--warning-orange);"></i>
                                    Departamento
                                </label>
                                <select id="editEmpDept" style="
                                    width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
                                    border-radius: 6px; font-size: 1rem;
                                ">
                                    <option value="General" ${employee.department === 'General' ? 'selected' : ''}>General</option>
                                    <option value="Desarme" ${employee.department === 'Desarme' ? 'selected' : ''}>Desarme</option>
                                    <option value="Reacondicionamiento" ${employee.department === 'Reacondicionamiento' ? 'selected' : ''}>Reacondicionamiento</option>
                                    <option value="Ventas" ${employee.department === 'Ventas' ? 'selected' : ''}>Ventas</option>
                                    <option value="Administración" ${employee.department === 'Administración' ? 'selected' : ''}>Administración</option>
                                    <option value="Logística" ${employee.department === 'Logística' ? 'selected' : ''}>Logística</option>
                                    <option value="Calidad" ${employee.department === 'Calidad' ? 'selected' : ''}>Control de Calidad</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-toggle-on" style="margin-right: 0.5rem; color: var(--primary-blue);"></i>
                                    Estado
                                </label>
                                <select id="editEmpActive" style="
                                    width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
                                    border-radius: 6px; font-size: 1rem;
                                ">
                                    <option value="true" ${employee.active ? 'selected' : ''}>Activo</option>
                                    <option value="false" ${!employee.active ? 'selected' : ''}>Inactivo</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-phone" style="margin-right: 0.5rem; color: var(--success-green);"></i>
                                    Teléfono
                                </label>
                                <input type="tel" id="editEmpPhone" value="${employee.phone || ''}" style="
                                    width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
                                    border-radius: 6px; font-size: 1rem;
                                ">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                                    <i class="fas fa-envelope" style="margin-right: 0.5rem; color: var(--primary-blue);"></i>
                                    Email
                                </label>
                                <input type="email" id="editEmpEmail" value="${employee.email || ''}" style="
                                    width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
                                    border-radius: 6px; font-size: 1rem;
                                ">
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: flex-end; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                            <button type="button" onclick="this.closest('div').parentElement.remove()" style="
                                padding: 0.75rem 1.5rem; border: 1px solid #e5e7eb; background: #f8fafc;
                                border-radius: 8px; cursor: pointer; color: var(--text-secondary); font-weight: 600;
                            ">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="submit" style="
                                padding: 0.75rem 1.5rem; border: none; background: var(--warning-orange);
                                color: white; border-radius: 8px; cursor: pointer; font-weight: 600;
                            ">
                                <i class="fas fa-save"></i> Guardar Cambios
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Manejar envío del formulario
            document.getElementById('editEmployeeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const updatedData = {
                    name: document.getElementById('editEmpName').value.trim(),
                    department: document.getElementById('editEmpDept').value,
                    phone: document.getElementById('editEmpPhone').value.trim(),
                    email: document.getElementById('editEmpEmail').value.trim(),
                    active: document.getElementById('editEmpActive').value === 'true'
                };
                
                if (!updatedData.name) {
                    showError('Campo Requerido', 'El nombre es obligatorio');
                    return;
                }
                
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
                
                fetch(`/api/employees/${employeeId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showSuccess('Empleado Actualizado', 'Los datos han sido actualizados exitosamente');
                        modal.remove();
                        loadEmployees();
                    } else {
                        showError('Error', data.message);
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Guardar Cambios';
                    }
                })
                .catch(error => {
                    showError('Error de Conexión', 'No se pudo actualizar el empleado');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Guardar Cambios';
                });
            });
            
            // Cerrar modal al hacer clic fuera
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function toggleEmployee(employeeId, currentStatus) {
            const action = currentStatus ? 'desactivar' : 'activar';
            showConfirm(
                `¿Cambiar Estado?`,
                `¿Estás seguro de ${action} este empleado?`
            ).then(confirmed => {
                if (confirmed) {
                    showLoading(`${action === 'activar' ? 'Activando' : 'Desactivando'} empleado...`);
                    
                    fetch(`/api/employees/${employeeId}/toggle`, {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        setTimeout(() => {
                            hideLoading();
                            if (data.success) {
                                showSuccess('Estado Cambiado', data.message);
                                loadEmployees();
                            } else {
                                showError('Error', data.message);
                            }
                        }, 400);
                    })
                    .catch(error => {
                        hideLoading();
                        showError('Error de Conexión', 'No se pudo cambiar el estado del empleado.');
                    });
                }
            });
        }

        function deleteEmployee(employeeId, employeeName) {
            showConfirm(
                '¿Eliminar Empleado?',
                `¿Estás seguro de eliminar a ${employeeName}? Esta acción no se puede deshacer.`
            ).then(confirmed => {
                if (confirmed) {
                    showLoading('Eliminando empleado...');
                    
                    fetch(`/api/employees/${employeeId}`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(data => {
                        setTimeout(() => {
                            hideLoading();
                            if (data.success) {
                                showSuccess('Empleado Eliminado', data.message);
                                loadEmployees();
                            } else {
                                showError('Error', data.message);
                            }
                        }, 600);
                    })
                    .catch(error => {
                        hideLoading();
                        showError('Error de Conexión', 'No se pudo eliminar el empleado. Verifica tu conexión.');
                    });
                }
            });
        }
    </script>
</body>
</html>